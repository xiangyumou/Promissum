# ğŸš€ è¿ç§»åˆ°è¿œç¨‹ API æœåŠ¡ - å®Œæˆ

## âœ… å·²å®Œæˆçš„æ”¹é€ 

### 1. æ–°å¢æ–‡ä»¶

- **`.env.local`** - ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶ï¼ˆéœ€è¦é…ç½®æ‚¨çš„ API åœ°å€å’Œ Tokenï¼‰
- **`src/lib/env.ts`** - ç±»å‹å®‰å…¨çš„ç¯å¢ƒå˜é‡è®¿é—®æ¨¡å—
- **`src/lib/api-client.ts`** - è¿œç¨‹ API å®¢æˆ·ç«¯å°è£…

### 2. ä¿®æ”¹çš„æ–‡ä»¶

**API Routes** (æ”¹ä¸ºä»£ç†æ¨¡å¼):
- `src/app/api/items/route.ts` - GET/POST ç«¯ç‚¹
- `src/app/api/items/[id]/route.ts` - GET/DELETE ç«¯ç‚¹  
- `src/app/api/items/[id]/extend/route.ts` - POST ç«¯ç‚¹

**ä¾èµ–é…ç½®**:
- `package.json` - ç§»é™¤äº† better-sqlite3, drand-client, tlock-js

### 3. åˆ é™¤çš„æ–‡ä»¶

- `src/lib/db.ts` - æœ¬åœ°æ•°æ®åº“é€»è¾‘ï¼ˆå·²ç§»é™¤ï¼‰
- `src/lib/tlock.ts` - æœ¬åœ°åŠ å¯†é€»è¾‘ï¼ˆå·²ç§»é™¤ï¼‰
- `src/lib/decryption.ts` - æœ¬åœ°è§£å¯†é€»è¾‘ï¼ˆå·²ç§»é™¤ï¼‰

---

## ğŸ“ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. é…ç½®ç¯å¢ƒå˜é‡

ç¼–è¾‘ `.env.local` æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„ API é…ç½®ï¼š

```bash
# Chaster API Configuration
CHASTER_API_URL=http://localhost:3000/api/v1
CHASTER_API_TOKEN=tok_your_actual_token_here
```

> **é‡è¦**: è¯·å°† `tok_your_actual_token_here` æ›¿æ¢ä¸ºæ‚¨çš„çœŸå® Token

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 4. æµ‹è¯•åŠŸèƒ½

è®¿é—® `http://localhost:3000` å¹¶æµ‹è¯•ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] åˆ›å»ºæ–‡æœ¬é¡¹ç›®
- [ ] åˆ›å»ºå›¾ç‰‡é¡¹ç›®ï¼ˆæµ‹è¯• Base64 è½¬æ¢ï¼‰
- [ ] æŸ¥çœ‹é¡¹ç›®åˆ—è¡¨
- [ ] æŸ¥çœ‹é”å®š/è§£é”é¡¹ç›®è¯¦æƒ…
- [ ] å»¶é•¿é”å®šæ—¶é—´
- [ ] åˆ é™¤é¡¹ç›®
- [ ] ç§»åŠ¨ç«¯å“åº”å¼å¸ƒå±€

---

## ğŸ” å…³é”®æ”¹é€ ç‚¹

### å›¾ç‰‡å¤„ç†

**åŸå®ç°**: ç›´æ¥ä¸Šä¼  File å¯¹è±¡
```javascript
formData.append('file', imageFile);
```

**æ–°å®ç°**: åœ¨åç«¯è½¬æ¢ä¸º Base64
```javascript
const arrayBuffer = await file.arrayBuffer();
const base64 = Buffer.from(arrayBuffer).toString('base64');
```

### API è·¯ç”±ä»£ç†æ¨¡å¼

å‰ç«¯ä»£ç **å®Œå…¨æ— éœ€ä¿®æ”¹**ï¼Œä»ç„¶è°ƒç”¨ `/api/items` ç­‰ç«¯ç‚¹ã€‚

åç«¯ API Routes ç°åœ¨å……å½“ä»£ç†å±‚ï¼š
```
å‰ç«¯ â†’ /api/items â†’ API Client â†’ è¿œç¨‹æœåŠ¡
```

### å“åº”æ ¼å¼æ˜ å°„

API Client å°†è¿œç¨‹ API å“åº”æ˜ å°„ä¸ºå‰ç«¯æœŸæœ›çš„æ ¼å¼ï¼Œç¡®ä¿å‘åå…¼å®¹ï¼š

```typescript
// è¿œç¨‹ API æ ¼å¼
{ id, type, unlocked, decryptAt, content }

// æ˜ å°„ä¸ºåŸæ ¼å¼
{ id, type, unlock, decrypt_at, created_at, layer_count, content }
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æ€§

- âœ… Token å­˜å‚¨åœ¨æœåŠ¡ç«¯ `.env.local`
- âœ… ä¸ä¼šæš´éœ²åœ¨å®¢æˆ·ç«¯ä»£ç 
- âœ… æ‰€æœ‰ API è¯·æ±‚éƒ½é€šè¿‡åç«¯ä»£ç†

### å…¼å®¹æ€§

- âœ… å‰ç«¯ UI ç»„ä»¶æ— éœ€ä»»ä½•ä¿®æ”¹
- âœ… ç”¨æˆ·ä½“éªŒå®Œå…¨ä¸€è‡´
- âœ… æ‰€æœ‰åŸæœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

### ä¾èµ–å˜åŒ–

**ç§»é™¤** (ä¸å†éœ€è¦):
- better-sqlite3 (æœ¬åœ°æ•°æ®åº“)
- drand-client (drand å®¢æˆ·ç«¯)
- tlock-js (æ—¶é—´é”åŠ å¯†)

**ä¿ç•™**:
- Next.js, React, Tailwind CSS
- uuid (ä»ç”¨äºç”Ÿæˆ ID)

---

## ğŸ¯ æ€»ç»“

âœ… æˆåŠŸå°†åº”ç”¨æ¶æ„ä»:**æœ¬åœ° SQLite + æœ¬åœ°åŠ å¯†**  
è½¬å˜ä¸º:**è¿œç¨‹ API æœåŠ¡è°ƒç”¨**

âœ… ç”¨æˆ·ä½“éªŒé›¶æ„ŸçŸ¥ï¼Œå‰ç«¯ä»£ç æ— éœ€ä¿®æ”¹

âœ… Token å®‰å…¨å­˜å‚¨åœ¨æœåŠ¡ç«¯

âœ… å›¾ç‰‡ Base64 è½¬æ¢è‡ªåŠ¨å¤„ç†

âœ… æ‰€æœ‰ API è·¯ç”±æ”¹ä¸ºä»£ç†æ¨¡å¼
